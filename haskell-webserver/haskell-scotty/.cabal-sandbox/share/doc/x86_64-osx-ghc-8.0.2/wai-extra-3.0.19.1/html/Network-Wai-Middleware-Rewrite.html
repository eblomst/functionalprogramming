<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Network.Wai.Middleware.Rewrite</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><script src="haddock-util.js" type="text/javascript"></script><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
window.onload = function () {pageLoad();setSynopsis("mini_Network-Wai-Middleware-Rewrite.html");};
//]]>
</script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">wai-extra-3.0.19.1: Provides some basic WAI handlers and middleware.</p></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>None</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Network.Wai.Middleware.Rewrite</p></div><div id="table-of-contents"><p class="caption">Contents</p><ul><li><a href="#g:1">How to use this module</a><ul><li><a href="#g:2">A note on semantics</a></li><li><a href="#g:3">Paths and Queries</a></li><li><a href="#g:4">An example rewriting paths with queries</a></li><li><a href="#g:5">Upgrading from wai-extra &#8804; 3.0.16.1</a></li></ul></li><li><a href="#g:6"><code>Middleware</code></a><ul><li><a href="#g:7">Recommended functions</a></li><li><a href="#g:8">Deprecated</a></li></ul></li><li><a href="#g:9">Operating on <code>Request</code>s</a></li></ul></div><div id="synopsis"><p id="control.syn" class="caption expander" onclick="toggleSection('syn')">Synopsis</p><ul id="section.syn" class="hide" onclick="toggleSection('syn')"><li class="src short"><span class="keyword">type</span> <a href="#t:PathsAndQueries">PathsAndQueries</a> = ([<a href="file:///Users/emmablomsterberg/NetBeansProjects/functionalprogramming/haskell-webserver/haskell-scotty/.cabal-sandbox/share/doc/x86_64-osx-ghc-8.0.2/text-1.2.2.1/html/Data-Text.html#t:Text">Text</a>], <a href="file:///Users/emmablomsterberg/NetBeansProjects/functionalprogramming/haskell-webserver/haskell-scotty/.cabal-sandbox/share/doc/x86_64-osx-ghc-8.0.2/http-types-0.9.1/html/Network-HTTP-Types-URI.html#t:Query">Query</a>)</li><li class="src short"><a href="#v:rewriteWithQueries">rewriteWithQueries</a> :: (<a href="Network-Wai-Middleware-Rewrite.html#t:PathsAndQueries">PathsAndQueries</a> -&gt; <a href="file:///Users/emmablomsterberg/NetBeansProjects/functionalprogramming/haskell-webserver/haskell-scotty/.cabal-sandbox/share/doc/x86_64-osx-ghc-8.0.2/http-types-0.9.1/html/Network-HTTP-Types-Header.html#t:RequestHeaders">RequestHeaders</a> -&gt; <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/System-IO.html#t:IO">IO</a> <a href="Network-Wai-Middleware-Rewrite.html#t:PathsAndQueries">PathsAndQueries</a>) -&gt; <a href="file:///Users/emmablomsterberg/NetBeansProjects/functionalprogramming/haskell-webserver/haskell-scotty/.cabal-sandbox/share/doc/x86_64-osx-ghc-8.0.2/wai-3.2.1.1/html/Network-Wai.html#t:Middleware">Middleware</a></li><li class="src short"><a href="#v:rewritePureWithQueries">rewritePureWithQueries</a> :: (<a href="Network-Wai-Middleware-Rewrite.html#t:PathsAndQueries">PathsAndQueries</a> -&gt; <a href="file:///Users/emmablomsterberg/NetBeansProjects/functionalprogramming/haskell-webserver/haskell-scotty/.cabal-sandbox/share/doc/x86_64-osx-ghc-8.0.2/http-types-0.9.1/html/Network-HTTP-Types-Header.html#t:RequestHeaders">RequestHeaders</a> -&gt; <a href="Network-Wai-Middleware-Rewrite.html#t:PathsAndQueries">PathsAndQueries</a>) -&gt; <a href="file:///Users/emmablomsterberg/NetBeansProjects/functionalprogramming/haskell-webserver/haskell-scotty/.cabal-sandbox/share/doc/x86_64-osx-ghc-8.0.2/wai-3.2.1.1/html/Network-Wai.html#t:Middleware">Middleware</a></li><li class="src short"><a href="#v:rewrite">rewrite</a> :: ([<a href="file:///Users/emmablomsterberg/NetBeansProjects/functionalprogramming/haskell-webserver/haskell-scotty/.cabal-sandbox/share/doc/x86_64-osx-ghc-8.0.2/text-1.2.2.1/html/Data-Text.html#t:Text">Text</a>] -&gt; <a href="file:///Users/emmablomsterberg/NetBeansProjects/functionalprogramming/haskell-webserver/haskell-scotty/.cabal-sandbox/share/doc/x86_64-osx-ghc-8.0.2/http-types-0.9.1/html/Network-HTTP-Types-Header.html#t:RequestHeaders">RequestHeaders</a> -&gt; <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/System-IO.html#t:IO">IO</a> [<a href="file:///Users/emmablomsterberg/NetBeansProjects/functionalprogramming/haskell-webserver/haskell-scotty/.cabal-sandbox/share/doc/x86_64-osx-ghc-8.0.2/text-1.2.2.1/html/Data-Text.html#t:Text">Text</a>]) -&gt; <a href="file:///Users/emmablomsterberg/NetBeansProjects/functionalprogramming/haskell-webserver/haskell-scotty/.cabal-sandbox/share/doc/x86_64-osx-ghc-8.0.2/wai-3.2.1.1/html/Network-Wai.html#t:Middleware">Middleware</a></li><li class="src short"><a href="#v:rewritePure">rewritePure</a> :: ([<a href="file:///Users/emmablomsterberg/NetBeansProjects/functionalprogramming/haskell-webserver/haskell-scotty/.cabal-sandbox/share/doc/x86_64-osx-ghc-8.0.2/text-1.2.2.1/html/Data-Text.html#t:Text">Text</a>] -&gt; <a href="file:///Users/emmablomsterberg/NetBeansProjects/functionalprogramming/haskell-webserver/haskell-scotty/.cabal-sandbox/share/doc/x86_64-osx-ghc-8.0.2/http-types-0.9.1/html/Network-HTTP-Types-Header.html#t:RequestHeaders">RequestHeaders</a> -&gt; [<a href="file:///Users/emmablomsterberg/NetBeansProjects/functionalprogramming/haskell-webserver/haskell-scotty/.cabal-sandbox/share/doc/x86_64-osx-ghc-8.0.2/text-1.2.2.1/html/Data-Text.html#t:Text">Text</a>]) -&gt; <a href="file:///Users/emmablomsterberg/NetBeansProjects/functionalprogramming/haskell-webserver/haskell-scotty/.cabal-sandbox/share/doc/x86_64-osx-ghc-8.0.2/wai-3.2.1.1/html/Network-Wai.html#t:Middleware">Middleware</a></li><li class="src short"><a href="#v:rewriteRequest">rewriteRequest</a> :: (<a href="Network-Wai-Middleware-Rewrite.html#t:PathsAndQueries">PathsAndQueries</a> -&gt; <a href="file:///Users/emmablomsterberg/NetBeansProjects/functionalprogramming/haskell-webserver/haskell-scotty/.cabal-sandbox/share/doc/x86_64-osx-ghc-8.0.2/http-types-0.9.1/html/Network-HTTP-Types-Header.html#t:RequestHeaders">RequestHeaders</a> -&gt; <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/System-IO.html#t:IO">IO</a> <a href="Network-Wai-Middleware-Rewrite.html#t:PathsAndQueries">PathsAndQueries</a>) -&gt; <a href="file:///Users/emmablomsterberg/NetBeansProjects/functionalprogramming/haskell-webserver/haskell-scotty/.cabal-sandbox/share/doc/x86_64-osx-ghc-8.0.2/wai-3.2.1.1/html/Network-Wai.html#t:Request">Request</a> -&gt; <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/System-IO.html#t:IO">IO</a> <a href="file:///Users/emmablomsterberg/NetBeansProjects/functionalprogramming/haskell-webserver/haskell-scotty/.cabal-sandbox/share/doc/x86_64-osx-ghc-8.0.2/wai-3.2.1.1/html/Network-Wai.html#t:Request">Request</a></li><li class="src short"><a href="#v:rewriteRequestPure">rewriteRequestPure</a> :: (<a href="Network-Wai-Middleware-Rewrite.html#t:PathsAndQueries">PathsAndQueries</a> -&gt; <a href="file:///Users/emmablomsterberg/NetBeansProjects/functionalprogramming/haskell-webserver/haskell-scotty/.cabal-sandbox/share/doc/x86_64-osx-ghc-8.0.2/http-types-0.9.1/html/Network-HTTP-Types-Header.html#t:RequestHeaders">RequestHeaders</a> -&gt; <a href="Network-Wai-Middleware-Rewrite.html#t:PathsAndQueries">PathsAndQueries</a>) -&gt; <a href="file:///Users/emmablomsterberg/NetBeansProjects/functionalprogramming/haskell-webserver/haskell-scotty/.cabal-sandbox/share/doc/x86_64-osx-ghc-8.0.2/wai-3.2.1.1/html/Network-Wai.html#t:Request">Request</a> -&gt; <a href="file:///Users/emmablomsterberg/NetBeansProjects/functionalprogramming/haskell-webserver/haskell-scotty/.cabal-sandbox/share/doc/x86_64-osx-ghc-8.0.2/wai-3.2.1.1/html/Network-Wai.html#t:Request">Request</a></li></ul></div><div id="interface"><h1 id="g:1">How to use this module</h1><div class="doc"><p>This module provides <code><a href="file:///Users/emmablomsterberg/NetBeansProjects/functionalprogramming/haskell-webserver/haskell-scotty/.cabal-sandbox/share/doc/x86_64-osx-ghc-8.0.2/wai-3.2.1.1/html/Network-Wai.html#t:Middleware">Middleware</a></code> to rewrite URL paths. It also provides
 functions that will convert a <code><a href="file:///Users/emmablomsterberg/NetBeansProjects/functionalprogramming/haskell-webserver/haskell-scotty/.cabal-sandbox/share/doc/x86_64-osx-ghc-8.0.2/wai-3.2.1.1/html/Network-Wai.html#t:Request">Request</a></code> to a modified <code><a href="file:///Users/emmablomsterberg/NetBeansProjects/functionalprogramming/haskell-webserver/haskell-scotty/.cabal-sandbox/share/doc/x86_64-osx-ghc-8.0.2/wai-3.2.1.1/html/Network-Wai.html#t:Request">Request</a></code>.
 Both operations require a function that takes URL parameters and
 headers, and returns new URL parameters. Parameters are pieces of URL
 paths and query parameters.</p><p>If you are a new user of the library, use <code><a href="Network-Wai-Middleware-Rewrite.html#v:rewriteWithQueries">rewriteWithQueries</a></code> or
 <code><a href="Network-Wai-Middleware-Rewrite.html#v:rewritePureWithQueries">rewritePureWithQueries</a></code> for middleware. For modifying <code><a href="file:///Users/emmablomsterberg/NetBeansProjects/functionalprogramming/haskell-webserver/haskell-scotty/.cabal-sandbox/share/doc/x86_64-osx-ghc-8.0.2/wai-3.2.1.1/html/Network-Wai.html#t:Request">Request</a></code>s
 directly, use <code><a href="Network-Wai-Middleware-Rewrite.html#v:rewriteRequest">rewriteRequest</a></code> or <code><a href="Network-Wai-Middleware-Rewrite.html#v:rewriteRequestPure">rewriteRequestPure</a></code>.</p></div><h2 id="g:2">A note on semantics</h2><div class="doc"><p>Versions of this library in wai-extra &#8804; 3.0.16.1 exported only
 <code><a href="Network-Wai-Middleware-Rewrite.html#v:rewrite">rewrite</a></code> and <code><a href="Network-Wai-Middleware-Rewrite.html#v:rewritePure">rewritePure</a></code> and both modified <code><a href="file:///Users/emmablomsterberg/NetBeansProjects/functionalprogramming/haskell-webserver/haskell-scotty/.cabal-sandbox/share/doc/x86_64-osx-ghc-8.0.2/wai-3.2.1.1/html/Network-Wai.html#v:rawPathInfo">rawPathInfo</a></code> of the
 underlying requests. Such modification has been proscribed. The
 semantics of these functions have not changed; instead the recommended
 approach is to use <code><a href="Network-Wai-Middleware-Rewrite.html#v:rewriteWithQueries">rewriteWithQueries</a></code> and <code><a href="Network-Wai-Middleware-Rewrite.html#v:rewritePureWithQueries">rewritePureWithQueries</a></code>.
 The new functions are slightly different, as described in the section
 on upgrading; code for previous library versions can be upgraded with
 a single change, and as the type of the new function is different the
 compiler will indicate where this change must be made.</p><p>The <code><a href="Network-Wai-Middleware-Rewrite.html#v:rewriteRequest">rewriteRequest</a></code> and <code><a href="Network-Wai-Middleware-Rewrite.html#v:rewriteRequestPure">rewriteRequestPure</a></code> functions use the new
 semantics, too.</p></div><h2 id="g:3">Paths and Queries</h2><div class="doc"><p>This library defines the type synonym <code><a href="Network-Wai-Middleware-Rewrite.html#t:PathsAndQueries">PathsAndQueries</a></code> to make code
 handling paths and queries easier to read.</p><p><em>e.g.</em> <em>/foo/bar</em> would look like</p><pre>[&quot;foo&quot;, &quot;bar&quot;] :: Text</pre><p><em>?bar=baz</em> would look like</p><pre>[(&quot;bar&quot;, Just &quot;baz&quot;)] :: QueryText</pre><p>Together,</p><p><em>/foo?bar=baz</em> would look like</p><pre>([&quot;foo&quot;],[(&quot;bar&quot;, Just &quot;baz&quot;)]) :: PathsAndQueries</pre></div><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:PathsAndQueries" class="def">PathsAndQueries</a> = ([<a href="file:///Users/emmablomsterberg/NetBeansProjects/functionalprogramming/haskell-webserver/haskell-scotty/.cabal-sandbox/share/doc/x86_64-osx-ghc-8.0.2/text-1.2.2.1/html/Data-Text.html#t:Text">Text</a>], <a href="file:///Users/emmablomsterberg/NetBeansProjects/functionalprogramming/haskell-webserver/haskell-scotty/.cabal-sandbox/share/doc/x86_64-osx-ghc-8.0.2/http-types-0.9.1/html/Network-HTTP-Types-URI.html#t:Query">Query</a>) <a href="#t:PathsAndQueries" class="selflink">#</a></p><div class="doc"><p>A tuple of the path sections as [<code><a href="file:///Users/emmablomsterberg/NetBeansProjects/functionalprogramming/haskell-webserver/haskell-scotty/.cabal-sandbox/share/doc/x86_64-osx-ghc-8.0.2/text-1.2.2.1/html/Data-Text.html#t:Text">Text</a></code>] and query parameters as
 <code><a href="file:///Users/emmablomsterberg/NetBeansProjects/functionalprogramming/haskell-webserver/haskell-scotty/.cabal-sandbox/share/doc/x86_64-osx-ghc-8.0.2/http-types-0.9.1/html/Network-HTTP-Types-URI.html#t:Query">Query</a></code>. This makes writing type signatures for the conversion
 function far more pleasant.</p><p>Note that this uses <code><a href="file:///Users/emmablomsterberg/NetBeansProjects/functionalprogramming/haskell-webserver/haskell-scotty/.cabal-sandbox/share/doc/x86_64-osx-ghc-8.0.2/http-types-0.9.1/html/Network-HTTP-Types-URI.html#t:Query">Query</a></code> not <code><a href="file:///Users/emmablomsterberg/NetBeansProjects/functionalprogramming/haskell-webserver/haskell-scotty/.cabal-sandbox/share/doc/x86_64-osx-ghc-8.0.2/http-types-0.9.1/html/Network-HTTP-Types-URI.html#t:QueryText">QueryText</a></code> to more accurately
 reflect the paramaters that can be supplied in URLs. It may be safe to
 treat parameters as text; use the <code><a href="file:///Users/emmablomsterberg/NetBeansProjects/functionalprogramming/haskell-webserver/haskell-scotty/.cabal-sandbox/share/doc/x86_64-osx-ghc-8.0.2/http-types-0.9.1/html/Network-HTTP-Types-URI.html#v:queryToQueryText">queryToQueryText</a></code> and
 <code><a href="file:///Users/emmablomsterberg/NetBeansProjects/functionalprogramming/haskell-webserver/haskell-scotty/.cabal-sandbox/share/doc/x86_64-osx-ghc-8.0.2/http-types-0.9.1/html/Network-HTTP-Types-URI.html#v:queryTextToQuery">queryTextToQuery</a></code> functions to interconvert.</p></div></div><h2 id="g:4">An example rewriting paths with queries</h2><div class="doc"><p>Let&#8217;s say we want to replace a website written in PHP with one written
 using WAI. We&#8217;ll use the
 <a href="https://hackage.haskell.org/package/http-reverse-proxy">http-reverse-proxy</a>
 package to serve the old
 site from the new site, but there&#8217;s a problem. The old site uses pages like</p><pre>index.php?page=<em>page</em>
</pre><p>whereas the new site would look like</p><pre>index/<em>page</em>
</pre><p>In doing this, we want to separate the migration code from our new
 website. So we&#8217;d like to handle links internally using the path
 formulation, but externally have the old links still work.</p><p>Therefore, we will use middleware (<code><a href="Network-Wai-Middleware-Rewrite.html#v:rewritePureWithQueries">rewritePureWithQueries</a></code>) from this
 module to rewrite incoming requests from the query formulation to the
 paths formulation.</p><pre>{-# LANGUAGE ViewPatterns #-}

rewritePathFromPhp :: Middleware
rewritePathFromPhp = rewritePureWithQueries pathFromPhp

pathFromPhp :: PathsAndQueries -&gt; H.RequestHeaders -&gt; PathsAndQueries
pathFromPhp (pieces, queries) _ = piecesConvert pieces queries
    where
        piecesConvert :: [Text] -&gt; H.Query -&gt; PathsAndQueries
        piecesConvert [&quot;index.php&quot;] qs@(join . lookup &quot;page&quot; -&gt; Just page) =
            ( [&quot;index&quot;, TE.decodeUtf8With TE.lenientDecode page]
            , delete (&quot;page&quot;, pure page) qs
            )
        piecesConvert ps qs = (ps, qs)</pre><p>On the other side, we will use <code><a href="Network-Wai-Middleware-Rewrite.html#v:rewriteRequestPure">rewriteRequestPure</a></code> to rewrite outgoing
 requests to the original website from the reverse proxy code (using the
 <code><a href="Network-HTTP-ReverseProxy.html#v:WPRModifiedRequest">WPRModifiedRequest</a></code> or
 <code><a href="Network-HTTP-ReverseProxy.html#v:WPRModifiedRequestSecure">WPRModifiedRequestSecure</a></code> constructors. Note,
 these links will only work if the haddock documentation for
 <a href="https://hackage.haskell.org/package/http-reverse-proxy">http-reverse-proxy</a>
 is installed).</p><pre>rewritePhpFromPath :: Request -&gt; Request
rewritePhpFromPath = rewriteRequestPure phpFromPath

phpFromPath :: PathsAndQueries -&gt; H.RequestHeaders -&gt; PathsAndQueries
phpFromPath (pieces, queries) _ = piecesConvert pieces queries
    where
        piecesConvert :: [Text] -&gt; H.Query -&gt; PathsAndQueries
        piecesConvert [&quot;index&quot;, page] qs = ( [&quot;index.php&quot;], (&quot;page&quot;, pure . TE.encodeUtf8 $ page) : qs )
        piecesConvert ps qs = (ps, qs)</pre><p>For the whole example, see
 <a href="https://gist.github.com/dbaynard/c844d0df124f68ec8b6da152c581ce6d">https://gist.github.com/dbaynard/c844d0df124f68ec8b6da152c581ce6d</a>.</p></div><h2 id="g:5">Upgrading from wai-extra &#8804; 3.0.16.1</h2><div class="doc"><p>It is quite simple to upgrade from <code><a href="Network-Wai-Middleware-Rewrite.html#v:rewrite">rewrite</a></code> and <code><a href="Network-Wai-Middleware-Rewrite.html#v:rewritePure">rewritePure</a></code>, to
 <code><a href="Network-Wai-Middleware-Rewrite.html#v:rewriteWithQueries">rewriteWithQueries</a></code> and <code><a href="Network-Wai-Middleware-Rewrite.html#v:rewritePureWithQueries">rewritePureWithQueries</a></code>.
 Insert <code><a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/Data-Bifunctor.html#v:first">first</a></code>, which specialises to</p><pre><code><a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/Data-Bifunctor.html#v:first">first</a></code> :: ([<code><a href="file:///Users/emmablomsterberg/NetBeansProjects/functionalprogramming/haskell-webserver/haskell-scotty/.cabal-sandbox/share/doc/x86_64-osx-ghc-8.0.2/text-1.2.2.1/html/Data-Text.html#t:Text">Text</a></code>] -&gt; [<code><a href="file:///Users/emmablomsterberg/NetBeansProjects/functionalprogramming/haskell-webserver/haskell-scotty/.cabal-sandbox/share/doc/x86_64-osx-ghc-8.0.2/text-1.2.2.1/html/Data-Text.html#t:Text">Text</a></code>]) -&gt; <code><a href="Network-Wai-Middleware-Rewrite.html#t:PathsAndQueries">PathsAndQueries</a></code> -&gt; <code><a href="Network-Wai-Middleware-Rewrite.html#t:PathsAndQueries">PathsAndQueries</a></code>
</pre><p>as the following example demonstrates.</p><p>Old versions of the libary could only handle path pieces, not queries.
 This could have been supplied to <code><a href="Network-Wai-Middleware-Rewrite.html#v:rewritePure">rewritePure</a></code>.</p><pre>staticConvert' :: [Text] -&gt; H.RequestHeaders -&gt; [Text]
staticConvert' pieces _ = piecesConvert pieces
  where
   piecesConvert [] = [&quot;static&quot;, &quot;html&quot;, &quot;pages.html&quot;]
   piecesConvert route@(&quot;pages&quot;:_) = &quot;static&quot;:&quot;html&quot;:route
</pre><p>Instead, use this function, supplied to <code><a href="Network-Wai-Middleware-Rewrite.html#v:rewritePureWithQueries">rewritePureWithQueries</a></code>.</p><pre>staticConvert :: <code><a href="Network-Wai-Middleware-Rewrite.html#t:PathsAndQueries">PathsAndQueries</a></code> -&gt; H.RequestHeaders -&gt; <code><a href="Network-Wai-Middleware-Rewrite.html#t:PathsAndQueries">PathsAndQueries</a></code>
staticConvert pathsAndQueries _ = <code><a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/Data-Bifunctor.html#v:first">first</a></code> piecesConvert pathsAndQueries
  where
   piecesConvert [] = [&quot;static&quot;, &quot;html&quot;, &quot;pages.html&quot;]
   piecesConvert route@(&quot;pages&quot;:_) = &quot;static&quot;:&quot;html&quot;:route
</pre><p>The former formulation is deprecated for two reasons:</p><ol><li>The original formulation of <code><a href="Network-Wai-Middleware-Rewrite.html#v:rewrite">rewrite</a></code> modified <code><a href="file:///Users/emmablomsterberg/NetBeansProjects/functionalprogramming/haskell-webserver/haskell-scotty/.cabal-sandbox/share/doc/x86_64-osx-ghc-8.0.2/wai-3.2.1.1/html/Network-Wai.html#v:rawPathInfo">rawPathInfo</a></code>, which
   is deprecated behaviour.</li><li>The original formulation did not allow query parameters to
   influence the path.</li></ol><p>Concerning the first point, take care with semantics of your program when
 upgrading as the upgraded functions no longer modify <code><a href="file:///Users/emmablomsterberg/NetBeansProjects/functionalprogramming/haskell-webserver/haskell-scotty/.cabal-sandbox/share/doc/x86_64-osx-ghc-8.0.2/wai-3.2.1.1/html/Network-Wai.html#v:rawPathInfo">rawPathInfo</a></code>.</p></div><h1 id="g:6"><code><a href="file:///Users/emmablomsterberg/NetBeansProjects/functionalprogramming/haskell-webserver/haskell-scotty/.cabal-sandbox/share/doc/x86_64-osx-ghc-8.0.2/wai-3.2.1.1/html/Network-Wai.html#t:Middleware">Middleware</a></code></h1><h2 id="g:7">Recommended functions</h2><div class="top"><p class="src"><a id="v:rewriteWithQueries" class="def">rewriteWithQueries</a> :: (<a href="Network-Wai-Middleware-Rewrite.html#t:PathsAndQueries">PathsAndQueries</a> -&gt; <a href="file:///Users/emmablomsterberg/NetBeansProjects/functionalprogramming/haskell-webserver/haskell-scotty/.cabal-sandbox/share/doc/x86_64-osx-ghc-8.0.2/http-types-0.9.1/html/Network-HTTP-Types-Header.html#t:RequestHeaders">RequestHeaders</a> -&gt; <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/System-IO.html#t:IO">IO</a> <a href="Network-Wai-Middleware-Rewrite.html#t:PathsAndQueries">PathsAndQueries</a>) -&gt; <a href="file:///Users/emmablomsterberg/NetBeansProjects/functionalprogramming/haskell-webserver/haskell-scotty/.cabal-sandbox/share/doc/x86_64-osx-ghc-8.0.2/wai-3.2.1.1/html/Network-Wai.html#t:Middleware">Middleware</a> <a href="#v:rewriteWithQueries" class="selflink">#</a></p><div class="doc"><p>Rewrite based on your own conversion function for paths and queries.
 This function is to be supplied by users of this library, and operates
 in <code><a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/System-IO.html#t:IO">IO</a></code>.</p></div></div><div class="top"><p class="src"><a id="v:rewritePureWithQueries" class="def">rewritePureWithQueries</a> :: (<a href="Network-Wai-Middleware-Rewrite.html#t:PathsAndQueries">PathsAndQueries</a> -&gt; <a href="file:///Users/emmablomsterberg/NetBeansProjects/functionalprogramming/haskell-webserver/haskell-scotty/.cabal-sandbox/share/doc/x86_64-osx-ghc-8.0.2/http-types-0.9.1/html/Network-HTTP-Types-Header.html#t:RequestHeaders">RequestHeaders</a> -&gt; <a href="Network-Wai-Middleware-Rewrite.html#t:PathsAndQueries">PathsAndQueries</a>) -&gt; <a href="file:///Users/emmablomsterberg/NetBeansProjects/functionalprogramming/haskell-webserver/haskell-scotty/.cabal-sandbox/share/doc/x86_64-osx-ghc-8.0.2/wai-3.2.1.1/html/Network-Wai.html#t:Middleware">Middleware</a> <a href="#v:rewritePureWithQueries" class="selflink">#</a></p><div class="doc"><p>Rewrite based on pure conversion function for paths and queries. This
 function is to be supplied by users of this library.</p></div></div><h2 id="g:8">Deprecated</h2><div class="top"><p class="src"><a id="v:rewrite" class="def">rewrite</a> :: ([<a href="file:///Users/emmablomsterberg/NetBeansProjects/functionalprogramming/haskell-webserver/haskell-scotty/.cabal-sandbox/share/doc/x86_64-osx-ghc-8.0.2/text-1.2.2.1/html/Data-Text.html#t:Text">Text</a>] -&gt; <a href="file:///Users/emmablomsterberg/NetBeansProjects/functionalprogramming/haskell-webserver/haskell-scotty/.cabal-sandbox/share/doc/x86_64-osx-ghc-8.0.2/http-types-0.9.1/html/Network-HTTP-Types-Header.html#t:RequestHeaders">RequestHeaders</a> -&gt; <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/System-IO.html#t:IO">IO</a> [<a href="file:///Users/emmablomsterberg/NetBeansProjects/functionalprogramming/haskell-webserver/haskell-scotty/.cabal-sandbox/share/doc/x86_64-osx-ghc-8.0.2/text-1.2.2.1/html/Data-Text.html#t:Text">Text</a>]) -&gt; <a href="file:///Users/emmablomsterberg/NetBeansProjects/functionalprogramming/haskell-webserver/haskell-scotty/.cabal-sandbox/share/doc/x86_64-osx-ghc-8.0.2/wai-3.2.1.1/html/Network-Wai.html#t:Middleware">Middleware</a> <a href="#v:rewrite" class="selflink">#</a></p><div class="doc"><div class="warning"><p>Warning: This modifies the <code><a href="file:///Users/emmablomsterberg/NetBeansProjects/functionalprogramming/haskell-webserver/haskell-scotty/.cabal-sandbox/share/doc/x86_64-osx-ghc-8.0.2/wai-3.2.1.1/html/Network-Wai.html#v:rawPathInfo">rawPathInfo</a></code> field of a <code><a href="file:///Users/emmablomsterberg/NetBeansProjects/functionalprogramming/haskell-webserver/haskell-scotty/.cabal-sandbox/share/doc/x86_64-osx-ghc-8.0.2/wai-3.2.1.1/html/Network-Wai.html#t:Request">Request</a></code>. This is not recommended behaviour; it is however how this function has worked in the past. Use <code><a href="Network-Wai-Middleware-Rewrite.html#v:rewriteWithQueries">rewriteWithQueries</a></code> instead</p></div><p>Rewrite based on your own conversion function for paths only, to be
 supplied by users of this library (with the conversion operating in <code><a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/System-IO.html#t:IO">IO</a></code>).</p><p>For new code, use <code><a href="Network-Wai-Middleware-Rewrite.html#v:rewriteWithQueries">rewriteWithQueries</a></code> instead.</p></div></div><div class="top"><p class="src"><a id="v:rewritePure" class="def">rewritePure</a> :: ([<a href="file:///Users/emmablomsterberg/NetBeansProjects/functionalprogramming/haskell-webserver/haskell-scotty/.cabal-sandbox/share/doc/x86_64-osx-ghc-8.0.2/text-1.2.2.1/html/Data-Text.html#t:Text">Text</a>] -&gt; <a href="file:///Users/emmablomsterberg/NetBeansProjects/functionalprogramming/haskell-webserver/haskell-scotty/.cabal-sandbox/share/doc/x86_64-osx-ghc-8.0.2/http-types-0.9.1/html/Network-HTTP-Types-Header.html#t:RequestHeaders">RequestHeaders</a> -&gt; [<a href="file:///Users/emmablomsterberg/NetBeansProjects/functionalprogramming/haskell-webserver/haskell-scotty/.cabal-sandbox/share/doc/x86_64-osx-ghc-8.0.2/text-1.2.2.1/html/Data-Text.html#t:Text">Text</a>]) -&gt; <a href="file:///Users/emmablomsterberg/NetBeansProjects/functionalprogramming/haskell-webserver/haskell-scotty/.cabal-sandbox/share/doc/x86_64-osx-ghc-8.0.2/wai-3.2.1.1/html/Network-Wai.html#t:Middleware">Middleware</a> <a href="#v:rewritePure" class="selflink">#</a></p><div class="doc"><div class="warning"><p>Warning: This modifies the <code><a href="file:///Users/emmablomsterberg/NetBeansProjects/functionalprogramming/haskell-webserver/haskell-scotty/.cabal-sandbox/share/doc/x86_64-osx-ghc-8.0.2/wai-3.2.1.1/html/Network-Wai.html#v:rawPathInfo">rawPathInfo</a></code> field of a <code><a href="file:///Users/emmablomsterberg/NetBeansProjects/functionalprogramming/haskell-webserver/haskell-scotty/.cabal-sandbox/share/doc/x86_64-osx-ghc-8.0.2/wai-3.2.1.1/html/Network-Wai.html#t:Request">Request</a></code>. This is not recommended behaviour; it is however how this function has worked in the past. Use <code><a href="Network-Wai-Middleware-Rewrite.html#v:rewritePureWithQueries">rewritePureWithQueries</a></code> instead</p></div><p>Rewrite based on pure conversion function for paths only, to be
 supplied by users of this library.</p><p>For new code, use <code><a href="Network-Wai-Middleware-Rewrite.html#v:rewritePureWithQueries">rewritePureWithQueries</a></code> instead.</p></div></div><h1 id="g:9">Operating on <code><a href="file:///Users/emmablomsterberg/NetBeansProjects/functionalprogramming/haskell-webserver/haskell-scotty/.cabal-sandbox/share/doc/x86_64-osx-ghc-8.0.2/wai-3.2.1.1/html/Network-Wai.html#t:Request">Request</a></code>s</h1><div class="top"><p class="src"><a id="v:rewriteRequest" class="def">rewriteRequest</a> :: (<a href="Network-Wai-Middleware-Rewrite.html#t:PathsAndQueries">PathsAndQueries</a> -&gt; <a href="file:///Users/emmablomsterberg/NetBeansProjects/functionalprogramming/haskell-webserver/haskell-scotty/.cabal-sandbox/share/doc/x86_64-osx-ghc-8.0.2/http-types-0.9.1/html/Network-HTTP-Types-Header.html#t:RequestHeaders">RequestHeaders</a> -&gt; <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/System-IO.html#t:IO">IO</a> <a href="Network-Wai-Middleware-Rewrite.html#t:PathsAndQueries">PathsAndQueries</a>) -&gt; <a href="file:///Users/emmablomsterberg/NetBeansProjects/functionalprogramming/haskell-webserver/haskell-scotty/.cabal-sandbox/share/doc/x86_64-osx-ghc-8.0.2/wai-3.2.1.1/html/Network-Wai.html#t:Request">Request</a> -&gt; <a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/System-IO.html#t:IO">IO</a> <a href="file:///Users/emmablomsterberg/NetBeansProjects/functionalprogramming/haskell-webserver/haskell-scotty/.cabal-sandbox/share/doc/x86_64-osx-ghc-8.0.2/wai-3.2.1.1/html/Network-Wai.html#t:Request">Request</a> <a href="#v:rewriteRequest" class="selflink">#</a></p><div class="doc"><p>Modify a <code><a href="file:///Users/emmablomsterberg/NetBeansProjects/functionalprogramming/haskell-webserver/haskell-scotty/.cabal-sandbox/share/doc/x86_64-osx-ghc-8.0.2/wai-3.2.1.1/html/Network-Wai.html#t:Request">Request</a></code> using the supplied function in <code><a href="file:///Library/Frameworks/GHC.framework/Versions/8.0.2-x86_64/usr/share/doc/ghc-8.0.2/html/libraries/base-4.9.1.0/System-IO.html#t:IO">IO</a></code>. This is suitable for
 the reverse proxy example.</p></div></div><div class="top"><p class="src"><a id="v:rewriteRequestPure" class="def">rewriteRequestPure</a> :: (<a href="Network-Wai-Middleware-Rewrite.html#t:PathsAndQueries">PathsAndQueries</a> -&gt; <a href="file:///Users/emmablomsterberg/NetBeansProjects/functionalprogramming/haskell-webserver/haskell-scotty/.cabal-sandbox/share/doc/x86_64-osx-ghc-8.0.2/http-types-0.9.1/html/Network-HTTP-Types-Header.html#t:RequestHeaders">RequestHeaders</a> -&gt; <a href="Network-Wai-Middleware-Rewrite.html#t:PathsAndQueries">PathsAndQueries</a>) -&gt; <a href="file:///Users/emmablomsterberg/NetBeansProjects/functionalprogramming/haskell-webserver/haskell-scotty/.cabal-sandbox/share/doc/x86_64-osx-ghc-8.0.2/wai-3.2.1.1/html/Network-Wai.html#t:Request">Request</a> -&gt; <a href="file:///Users/emmablomsterberg/NetBeansProjects/functionalprogramming/haskell-webserver/haskell-scotty/.cabal-sandbox/share/doc/x86_64-osx-ghc-8.0.2/wai-3.2.1.1/html/Network-Wai.html#t:Request">Request</a> <a href="#v:rewriteRequestPure" class="selflink">#</a></p><div class="doc"><p>Modify a <code><a href="file:///Users/emmablomsterberg/NetBeansProjects/functionalprogramming/haskell-webserver/haskell-scotty/.cabal-sandbox/share/doc/x86_64-osx-ghc-8.0.2/wai-3.2.1.1/html/Network-Wai.html#t:Request">Request</a></code> using the pure supplied function. This is suitable for
 the reverse proxy example.</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.17.3</p></div></body></html>